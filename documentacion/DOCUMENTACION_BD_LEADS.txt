DOCUMENTACION BD LEADS (SQLite)
Fecha: 2026-02-18

Resumen
El endpoint de contacto guarda cada lead en una base SQLite local para consulta interna, ademas de enviar el lead a Pipedrive.

Ubicacion de la BD
- Archivo: storage/leads.sqlite
- Se crea automaticamente en el primer envio si no existe.

Archivo de logica
- helpers/leads_db.php

Tabla: leads
Campos:
- id (INTEGER, PK, autoincrement)
- full_name (TEXT, NOT NULL)
- email (TEXT, NOT NULL)
- phone (TEXT, NOT NULL)
- interest (TEXT, NOT NULL)
- source (TEXT, NULL)
- message (TEXT, NULL)
- channel (TEXT, NULL)
- medium (TEXT, NULL)
- pipedrive_person_id (TEXT, NULL)
- status (TEXT, NOT NULL)
- error_message (TEXT, NULL)
- ip (TEXT, NULL)
- user_agent (TEXT, NULL)
- created_at (TEXT, NOT NULL, ISO 8601)

Estados (status)
- received: lead recibido en el endpoint
- pipedrive_ok: lead creado correctamente en Pipedrive
- pipedrive_failed: Pipedrive fallo (ver error_message)

Flujo de guardado
1) Llega POST a /api/contacto (controller: controllers/api/contacto.php)
2) Se valida la informacion requerida
3) Se inserta registro en SQLite con status = received
4) Se envia a Pipedrive
5) Si Pipedrive responde OK: status = pipedrive_ok + pipedrive_person_id
6) Si Pipedrive falla: status = pipedrive_failed + error_message

Panel de gestion
- Login: /admin/leads-login
- Leads: /admin/leads
- Delete: /admin/leads/delete (POST)
- Logout: /admin/logout

Password de acceso
- config/leads.local.php (campo password)
- Alternativa: variable de entorno LEADS_PASSWORD

Notas
- El panel permite paginacion y ver 20/50/100/200 registros.
- El boton "Eliminar" borra el registro local, no afecta Pipedrive.
